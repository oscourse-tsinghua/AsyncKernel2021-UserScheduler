# 统一调度器需要解决的主要问题

每个进程都有一个主线程，当只有一个线程时，这个主线程就是进程本身，当这个线程发生调度，必然进行进程调度；不止一个线程时，多个线程共享进程同一地址空间的不同部分，发生调度时，可以进行线程调度，减少开销。

现在需要对线程-协程实现相似的功能。

当一个线程没有创建子协程时，这个线程本身就是一个协程，能够作为调度器的基本调度单位Task；当一个线程有多个协程时，这个线程的主协程与子协程，能够作为不同的Task加入到调度器。

难点：

1. 数据结构的设计。线程控制块必须保留（包括线程栈和上下文），可以给每个线程额外创建一个用于调度器处理的Task，根据线程状态维护TCB与Task这两个数据结构的同步，比如线程结束时，先把Task移出调度器，再回收TCB。

![](https://github.com/oscourse-tsinghua/AsyncKernel2021-UserScheduler/tree/master/img_src)
